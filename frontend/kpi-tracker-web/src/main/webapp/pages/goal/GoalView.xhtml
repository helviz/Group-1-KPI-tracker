<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/pages/californiatemplate/template.xhtml">

    <ui:define name="title">Goal Management</ui:define>
    <ui:define name="viewname">Goals</ui:define>
    <ui:define name="head">
        <h:outputScript name="js/chart.js" library="demo" />
        <h:outputStylesheet library="css" name="goal-management-styles.css" />
    </ui:define>

    <ui:define name="content">
        <h:form id="goalViewForm" enctype="multipart/form-data">
            <p:messages id="globalMessages" autoUpdate="true" closable="true" />

            <!-- Dashboard Metrics Cards -->
            <div class="grid mb-4">
                <div class="col-12 md:col-3">
                    <div class="metric-card">
                        <div class="text-xl font-bold mb-2">Total Goals</div>
                        <div class="text-3xl font-bold">#{not empty goalView.dashboardMetrics ?
                                goalView.dashboardMetrics.totalGoals : 0}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="metric-card">
                        <div class="text-xl font-bold mb-2">Active Goals</div>
                        <div class="text-3xl font-bold">#{not empty goalView.dashboardMetrics ?
                                goalView.dashboardMetrics.activeGoals : 0}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="metric-card">
                        <div class="text-xl font-bold mb-2">Completed Goals</div>
                        <div class="text-3xl font-bold">#{not empty goalView.dashboardMetrics ?
                                goalView.dashboardMetrics.completedGoals : 0}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="metric-card">
                        <div class="text-xl font-bold mb-2">Overdue Goals</div>
                        <div class="text-3xl font-bold">#{not empty goalView.dashboardMetrics ?
                                goalView.dashboardMetrics.overdueGoals : 0}</div>
                    </div>
                </div>
            </div>

            <p:tabView id="goalTabs" activeIndex="#{goalView.activeTabIndex}">
                <p:tab id="myGoalsTab" title="My Goals">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="pi pi-list"></i> My Goals
                            </h5>
                            <p:commandButton id="createMyGoalBtn" value="Create New Goal" icon="pi pi-plus"
                                             actionListener="#{goalFormDialog.show}"
                                             update=":goalViewForm:globalMessages"
                                             styleClass="p-button-success">
                                <f:setPropertyActionListener value="#{null}" target="#{goalFormDialog.model}" />
                                <p:ajax event="dialogReturn" listener="#{goalView.reloadFilterReset}"
                                        update=":goalViewForm:goalTabs :goalViewForm:globalMessages" />
                            </p:commandButton>
                        </div>
                        <div class="card-body">
                            <p:dataTable id="myGoalsTable" value="#{goalView.myGoals}" var="goal"
                                         styleClass="w-full" emptyMessage="No individual goals found"
                                         paginator="true" rows="10" paginatorPosition="bottom"
                                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,20,50">
                                <p:column headerText="Goal Name" sortBy="#{goal.goalName}"
                                          filterBy="#{goal.goalName}" filterMatchMode="contains">
                                    <h:outputText value="#{goal.goalName}" />
                                </p:column>
                                <p:column headerText="Department" sortBy="#{goal.department.name}">
                                    <h:outputText value="#{not empty goal.department ? goal.department.name : ''}" />
                                </p:column>
                                <p:column headerText="Weight" sortBy="#{goal.weight}">
                                    <h:outputText value="#{goal.weight}%" />
                                </p:column>
                                <p:column headerText="Parent Goal" sortBy="#{goal.parentGoal.goalName}">
                                    <h:outputText value="#{not empty goal.parentGoal ? goal.parentGoal.goalName : ''}" />
                                </p:column>
                                <p:column headerText="Progress" sortBy="#{goal.progress}">
                                    <div class="flex align-items-center">
                                        <p:progressBar value="#{goal.progress}" styleClass="flex-1 mr-2" />
                                        <span class="text-sm">#{goal.progress}%</span>
                                    </div>
                                </p:column>
                                <p:column headerText="End Date" sortBy="#{goal.endDate}">
                                    <h:outputText value="#{goal.endDate}">
                                        <f:convertDateTime pattern="MMM dd, yyyy" />
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Status" sortBy="#{goal.goalStatus}">
                                    <h:outputText value="#{goal.goalStatus}"
                                                  styleClass="ui-tag #{goal.goalStatus == 'Completed' ? 'status-completed' : goal.goalStatus == 'Overdue' ? 'status-overdue' : 'status-active'}" />
                                </p:column>
                                <p:column headerText="Actions" styleClass="text-center">
                                    <div class="flex justify-content-center">
                                        <p:commandButton id="editMyGoal_#{goal.id}" icon="pi pi-pencil"
                                                         styleClass="p-button-text p-button-sm mr-1"
                                                         actionListener="#{goalFormDialog.show}">
                                            <f:setPropertyActionListener value="#{goal}"
                                                                         target="#{goalFormDialog.model}" />
                                            <p:ajax event="dialogReturn" listener="#{goalView.reloadFilterReset}"
                                                    update=":goalViewForm:goalTabs :goalViewForm:globalMessages" />
                                        </p:commandButton>
                                        <p:commandButton id="deleteMyGoal_#{goal.id}" icon="pi pi-trash"
                                                         styleClass="p-button-text p-button-danger p-button-sm"
                                                         actionListener="#{goalView.deleteSelectedGoal(goal)}"
                                                         update=":goalViewForm:goalTabs :goalViewForm:globalMessages">
                                            <p:confirm header="Confirmation"
                                                       message="You are about to delete goal '#{goal.goalName}'. Are you sure?"
                                                       icon="pi pi-exclamation-triangle" />
                                        </p:commandButton>
                                    </div>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </p:tab>

                <p:tab id="orgGoalsTab" title="Organisation Goals">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="pi pi-list"></i> Organisation Goals
                            </h5>
                            <p:commandButton id="createOrgGoalBtn" value="Create New Goal" icon="pi pi-plus"
                                             actionListener="#{goalFormDialog.show}"
                                             update=":goalViewForm:globalMessages"
                                             styleClass="p-button-success">
                                <f:setPropertyActionListener value="#{null}" target="#{goalFormDialog.model}" />
                                <p:ajax event="dialogReturn" listener="#{goalView.reloadFilterReset}"
                                        update=":goalViewForm:goalTabs :goalViewForm:globalMessages" />
                            </p:commandButton>
                        </div>
                        <div class="card-body">
                            <p:dataTable id="orgGoalsTable" value="#{goalView.organisationGoals}" var="goal"
                                         styleClass="w-full" emptyMessage="No organisation goals found"
                                         paginator="true" rows="10" paginatorPosition="bottom"
                                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,20,50">
                                <p:column headerText="Goal Name" sortBy="#{goal.goalName}"
                                          filterBy="#{goal.goalName}" filterMatchMode="contains">
                                    <h:outputText value="#{goal.goalName}" />
                                </p:column>
                                <p:column headerText="Progress" sortBy="#{goal.progress}">
                                    <div class="flex align-items-center">
                                        <p:progressBar value="#{goal.progress}" styleClass="flex-1 mr-2" />
                                        <span class="text-sm">#{goal.progress}%</span>
                                    </div>
                                </p:column>
                                <p:column headerText="End Date" sortBy="#{goal.endDate}">
                                    <h:outputText value="#{goal.endDate}">
                                        <f:convertDateTime pattern="MMM dd, yyyy" />
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Status" sortBy="#{goal.goalStatus}">
                                    <h:outputText value="#{goal.goalStatus}"
                                                  styleClass="ui-tag #{goal.goalStatus == 'Completed' ? 'status-completed' : goal.goalStatus == 'Overdue' ? 'status-overdue' : 'status-active'}" />
                                </p:column>
                                <p:column headerText="Actions" styleClass="text-center">
                                    <div class="flex justify-content-center">
                                        <p:commandButton id="editOrgGoal_#{goal.id}" icon="pi pi-pencil"
                                                         styleClass="p-button-text p-button-sm mr-1"
                                                         actionListener="#{goalFormDialog.show}">
                                            <f:setPropertyActionListener value="#{goal}"
                                                                         target="#{goalFormDialog.model}" />
                                            <p:ajax event="dialogReturn" listener="#{goalView.reloadFilterReset}"
                                                    update=":goalViewForm:goalTabs :goalViewForm:globalMessages" />
                                        </p:commandButton>
                                        <p:commandButton id="deleteOrgGoal_#{goal.id}" icon="pi pi-trash"
                                                         styleClass="p-button-text p-button-danger p-button-sm"
                                                         actionListener="#{goalView.deleteSelectedGoal(goal)}"
                                                         update=":goalViewForm:goalTabs :goalViewForm:globalMessages">
                                            <p:confirm header="Confirmation"
                                                       message="You are about to delete goal '#{goal.goalName}'. Are you sure?"
                                                       icon="pi pi-exclamation-triangle" />
                                        </p:commandButton>
                                    </div>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </p:tab>

                <p:tab id="deptGoalsTab" title="Department Goals">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="pi pi-list"></i> Department Goals
                            </h5>
                            <p:commandButton id="createDeptGoalBtn" value="Create New Goal" icon="pi pi-plus"
                                             actionListener="#{goalFormDialog.show}"
                                             update=":goalViewForm:globalMessages"
                                             styleClass="p-button-success">
                                <f:setPropertyActionListener value="#{null}" target="#{goalFormDialog.model}" />
                                <p:ajax event="dialogReturn" listener="#{goalView.reloadFilterReset}"
                                        update=":goalViewForm:goalTabs :goalViewForm:globalMessages" />
                            </p:commandButton>
                        </div>
                        <div class="card-body">
                            <p:dataTable id="deptGoalsTable" value="#{goalView.departmentGoals}" var="goal"
                                         styleClass="w-full" emptyMessage="No department goals found"
                                         paginator="true" rows="10" paginatorPosition="bottom"
                                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,20,50">
                                <p:column headerText="Goal Name" sortBy="#{goal.goalName}"
                                          filterBy="#{goal.goalName}" filterMatchMode="contains">
                                    <h:outputText value="#{goal.goalName}" />
                                </p:column>
                                <p:column headerText="Department" sortBy="#{goal.department.name}">
                                    <h:outputText value="#{not empty goal.department ? goal.department.name : ''}" />
                                </p:column>
                                <p:column headerText="Parent Goal" sortBy="#{goal.parentGoal.goalName}">
                                    <h:outputText value="#{not empty goal.parentGoal ? goal.parentGoal.goalName : ''}" />
                                </p:column>
                                <p:column headerText="Progress" sortBy="#{goal.progress}">
                                    <div class="flex align-items-center">
                                        <p:progressBar value="#{goal.progress}" styleClass="flex-1 mr-2" />
                                        <span class="text-sm">#{goal.progress}%</span>
                                    </div>
                                </p:column>
                                <p:column headerText="End Date" sortBy="#{goal.endDate}">
                                    <h:outputText value="#{goal.endDate}">
                                        <f:convertDateTime pattern="MMM dd, yyyy" />
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Status" sortBy="#{goal.goalStatus}">
                                    <h:outputText value="#{goal.goalStatus}"
                                                  styleClass="ui-tag #{goal.goalStatus == 'Completed' ? 'status-completed' : goal.goalStatus == 'Overdue' ? 'status-overdue' : 'status-active'}" />
                                </p:column>
                                <p:column headerText="Actions" styleClass="text-center">
                                    <div class="flex justify-content-center">
                                        <p:commandButton id="editDeptGoal_#{goal.id}" icon="pi pi-pencil"
                                                         styleClass="p-button-text p-button-sm mr-1"
                                                         actionListener="#{goalFormDialog.show}">
                                            <f:setPropertyActionListener value="#{goal}"
                                                                         target="#{goalFormDialog.model}" />
                                            <p:ajax event="dialogReturn" listener="#{goalView.reloadFilterReset}"
                                                    update=":goalViewForm:goalTabs :goalViewForm:globalMessages" />
                                        </p:commandButton>
                                        <p:commandButton id="deleteDeptGoal_#{goal.id}" icon="pi pi-trash"
                                                         styleClass="p-button-text p-button-danger p-button-sm"
                                                         actionListener="#{goalView.deleteSelectedGoal(goal)}"
                                                         update=":goalViewForm:goalTabs :goalViewForm:globalMessages">
                                            <p:confirm header="Confirmation"
                                                       message="You are about to delete goal '#{goal.goalName}'. Are you sure?"
                                                       icon="pi pi-exclamation-triangle" />
                                        </p:commandButton>
                                    </div>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </p:tab>

                <p:tab id="teamGoalsTab" title="Team Goals">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="pi pi-list"></i> Team Goals
                            </h5>
                            <p:commandButton id="createTeamGoalBtn" value="Create New Goal" icon="pi pi-plus"
                                             actionListener="#{goalFormDialog.show}"
                                             update=":goalViewForm:globalMessages"
                                             styleClass="p-button-success">
                                <f:setPropertyActionListener value="#{null}" target="#{goalFormDialog.model}" />
                                <p:ajax event="dialogReturn" listener="#{goalView.reloadFilterReset}"
                                        update=":goalViewForm:goalTabs :goalViewForm:globalMessages" />
                            </p:commandButton>
                        </div>
                        <div class="card-body">
                            <p:dataTable id="teamGoalsTable" value="#{goalView.teamGoals}" var="goal"
                                         styleClass="w-full" emptyMessage="No team goals found"
                                         paginator="true" rows="10" paginatorPosition="bottom"
                                         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,20,50">
                                <p:column headerText="Goal Name" sortBy="#{goal.goalName}"
                                          filterBy="#{goal.goalName}" filterMatchMode="contains">
                                    <h:outputText value="#{goal.goalName}" />
                                </p:column>
                                <p:column headerText="Department" sortBy="#{goal.department.name}">
                                    <h:outputText value="#{not empty goal.department ? goal.department.name : ''}" />
                                </p:column>
                                <p:column headerText="Weight" sortBy="#{goal.weight}">
                                    <h:outputText value="#{goal.weight}%" />
                                </p:column>
                                <p:column headerText="Parent Goal" sortBy="#{goal.parentGoal.goalName}">
                                    <h:outputText value="#{not empty goal.parentGoal ? goal.parentGoal.goalName : ''}" />
                                </p:column>
                                <p:column headerText="Progress" sortBy="#{goal.progress}">
                                    <div class="flex align-items-center">
                                        <p:progressBar value="#{goal.progress}" styleClass="flex-1 mr-2" />
                                        <span class="text-sm">#{goal.progress}%</span>
                                    </div>
                                </p:column>
                                <p:column headerText="End Date" sortBy="#{goal.endDate}">
                                    <h:outputText value="#{goal.endDate}">
                                        <f:convertDateTime pattern="MMM dd, yyyy" />
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Status" sortBy="#{goal.goalStatus}">
                                    <h:outputText value="#{goal.goalStatus}"
                                                  styleClass="ui-tag #{goal.goalStatus == 'Completed' ? 'status-completed' : goal.goalStatus == 'Overdue' ? 'status-overdue' : 'status-active'}" />
                                </p:column>
                                <p:column headerText="Actions" styleClass="text-center">
                                    <div class="flex justify-content-center">
                                        <p:commandButton id="editTeamGoal_#{goal.id}" icon="pi pi-pencil"
                                                         styleClass="p-button-text p-button-sm mr-1"
                                                         actionListener="#{goalFormDialog.show}">
                                            <f:setPropertyActionListener value="#{goal}"
                                                                         target="#{goalFormDialog.model}" />
                                            <p:ajax event="dialogReturn" listener="#{goalView.reloadFilterReset}"
                                                    update=":goalViewForm:goalTabs :goalViewForm:globalMessages" />
                                        </p:commandButton>
                                        <p:commandButton id="deleteTeamGoal_#{goal.id}" icon="pi pi-trash"
                                                         styleClass="p-button-text p-button-danger p-button-sm"
                                                         actionListener="#{goalView.deleteSelectedGoal(goal)}"
                                                         update=":goalViewForm:goalTabs :goalViewForm:globalMessages">
                                            <p:confirm header="Confirmation"
                                                       message="You are about to delete goal '#{goal.goalName}'. Are you sure?"
                                                       icon="pi pi-exclamation-triangle" />
                                        </p:commandButton>
                                    </div>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </p:tab>
            </p:tabView>

            <p:confirmDialog global="true" id="globalConfirmDialog">
                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times" />
            </p:confirmDialog>
        </h:form>
        <ui:include src="/pages/goal/GoalFormDialog.xhtml" />
    </ui:define>


</ui:composition>