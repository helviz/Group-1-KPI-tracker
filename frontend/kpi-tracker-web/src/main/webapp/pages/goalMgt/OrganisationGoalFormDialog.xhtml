<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui" template="/pages/californiatemplate/dialog-template.xhtml">
    <ui:define name="viewname">Organisation Goals </ui:define>
    <ui:define name="head">
        <style type="text/css">
            .capitalized {
                text-transform: capitalize;
            }

            .ui-inputgroup .ui-inputfield,
            .ui-inputgroup .ui-calendar {
                width: 100%;
            }

            .ui-fluid .ui-inputgroup {
                margin-bottom: 1rem;
            }
        </style>
    </ui:define>

    <ui:define name="content">
        <h:form id="organisationGoalFormDialog" styleClass="card">
            <p:growl id="messages" showDetail="true" />

            <div class="p-grid ui-fluid">
                <div class="p-col-12 p-md-6">
                    <p:outputLabel for="goalTitle" value="Goal Title *" styleClass="field-label" />
                    <p:inputText id="goalTitle" value="#{organisationGoalFormDialog.model.title}"
                        placeholder="e.g. Increase Market Share" required="true"
                        requiredMessage="Goal title is required."
                        styleClass="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary" />
                    <p:message for="goalTitle" display="icon" />
                </div>
                <div class="p-col-12 p-md-6">
                    <p:outputLabel for="owner" value="Owner *" styleClass="field-label" />
                    <p:outputLabel id="owner"
                        value="#{organisationGoalFormDialog.owner != null ? organisationGoalFormDialog.owner.username : 'Not Assigned'}"
                        styleClass="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round" />
                    <p:message for="owner" display="icon" />
                </div>
                <div class="p-col-12 p-md-6">
                    <p:outputLabel for="period" value="Period *" styleClass="field-label" />
                    <p:selectOneMenu id="period" value="#{organisationGoalFormDialog.model.goalPeriod}"
                        converter="goalPeriodConverter" required="true" filter="true" filterMatchMode="contains"
                        requiredMessage="Period is required.">
                        <f:selectItem itemLabel="Select Period" itemValue="#{null}" />
                        <f:selectItems value="#{organisationGoalFormDialog.goalPeriods}" var="p1"
                            itemLabel="#{p1.periodName}" itemValue="#{p1}" />
                        <p:ajax event="change" update="periodStartDate periodEndDate" />
                    </p:selectOneMenu>
                    <p:message for="period" display="icon" />
                </div>
            </div>

            <div class="p-grid ui-fluid">
                <div class="p-col-12">
                    <p:outputLabel for="goalDescription" value="Description" styleClass="field-label" />
                    <p:inputTextarea id="goalDescription" value="#{organisationGoalFormDialog.model.description}"
                        rows="4" placeholder="Describe the goal objectives and expected outcomes..."
                        styleClass="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" />
                    <p:message for="goalDescription" display="icon" />
                </div>
            </div>

            <div class="p-grid ui-fluid">
                <div class="p-col-12">
                    <p:outputLabel value="Date Period" styleClass="field-label" />
                    <div class="text-muted text-sm">
                        The date period for this goal will be inherited from the selected goal period.
                    </div>
                    <div class="p-d-flex p-ai-center p-mt-2">
                        <i class="pi pi-calendar p-mr-2"></i>
                        <span class="text-base">
                            <strong>Start:</strong>
                            <p:outputPanel id="periodStartDate">
                                #{organisationGoalFormDialog.goalPeriodStartDate}
                            </p:outputPanel>
                        </span>
                        <span class="p-mx-2">-</span>
                        <span class="text-base">
                            <strong>End:</strong>
                            <p:outputPanel id="periodEndDate">
                                #{organisationGoalFormDialog.goalPeriodEndDate}
                            </p:outputPanel>
                        </span>
                    </div>
                </div>
            </div>
            <div class="p-grid ui-fluid">
                <div class="p-col-12">
                    <p:outputLabel value="Progress" styleClass="field-label" />
                    <div class="text-muted text-sm">
                        Progress is automatically calculated from child department goals and cannot be manually edited.
                    </div>
                    <p:outputLabel
                        value="#{organisationGoalFormDialog.model.progress != null ? organisationGoalFormDialog.model.progress : '0'}%" />
                    <p:progressBar
                        value="#{organisationGoalFormDialog.model.progress != null ? organisationGoalFormDialog.model.progress.intValue() : 0}"
                        style="width: 100%; margin-top: 0.5rem;" />
                </div>
            </div>

            <div class="p-col-12 p-d-flex p-jc-end p-mt-4">

                <p:commandButton value="Cancel" immediate="true" process="@this"
                    actionListener="#{organisationGoalFormDialog.hide}"
                    styleClass="ui-button-outlined ui-button-danger p-mr-2" />

                <p:commandButton value="Save" process="@form" actionListener="#{organisationGoalFormDialog.save}"
                    update="@form"/>
            </div>
        </h:form>
    </ui:define>
</ui:composition>