<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui" template="/pages/californiatemplate/dialog-template.xhtml">
    <ui:define name="head">
        <style type="text/css">
            .field-label {
                font-weight: bold;
                margin-bottom: 5px;
                display: block;
            }

            .required:after {
                content: " *";
                color: red;
            }

            .hierarchy-info {
                background-color: #f8f9fa;
                padding: 10px;
                border-radius: 5px;
                margin-bottom: 15px;
            }
        </style>
    </ui:define>
    <ui:define name="content">
        <title>Goal Details</title>
        <h:form id="goalFormDialog" style="height: 600px" styleClass="card">
            <p:messages id="messages" closable="true" showSummary="true" showDetail="true" />

            <div class="p-grid ui-fluid" style="display:flex; flex-direction: column;">

                <!-- Parent Goal Info -->
                <div class="ui-col-12" rendered="#{goalForm.model.parentGoal != null}">
                    <div class="hierarchy-info">
                        <strong>Parent Goal:</strong>
                        <h:outputText value="#{goalForm.model.parentGoal.goalTitle}"
                            style="font-weight: bold; color: #007bff;" />
                        <br />
                        <small style="color: #6c757d;">
                            Level:
                            <h:outputText value="#{goalForm.model.parentGoal.goalLevel.name}" /> |
                            Period:
                            <h:outputText value="#{goalForm.model.parentGoal.goalPeriod.periodName}" />
                        </small>
                    </div>
                </div>

                <!-- Goal Title -->
                <div class="ui-col-12">
                    <h5>Goal Title</h5>
                    <div class="ui-inputgroup">
                        <p:inputText value="#{goalForm.model.goalTitle}" placeholder="e.g., Increase Q4 Revenue by 25%"
                            required="true"
                            styleClass="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" />
                    </div>
                </div>

                <!-- Goal Period Selection (Conditional) -->
                <div class="ui-col-12" rendered="#{goalForm.showGoalPeriodSelection}">
                    <h5>Goal Period</h5>
                    <div class="ui-inputgroup">
                        <p:selectOneMenu value="#{goalForm.model.goalPeriod}" converter="goalPeriodConverter"
                            required="true"
                            styleClass="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full">
                            <f:selectItem itemLabel="Select Period" itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItems value="#{goalForm.goalPeriods}" var="period" itemLabel="#{period.periodName}"
                                itemValue="#{period}" />
                        </p:selectOneMenu>
                    </div>
                </div>

                <!-- Goal Level and Evaluation Weight in a 2-column grid -->
                <div class="ui-col-12 ui-md-6">
                    <h5>Goal Level</h5>
                    <div class="ui-inputgroup">
                        <p:selectOneMenu value="#{goalForm.model.goalLevel}" converter="goalLevelConverter"
                            required="true" disabled="#{goalForm.goalLevelDisabled}"
                            styleClass="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full">
                            <f:selectItem itemLabel="Select Level" itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItems value="#{goalForm.availableGoalLevels}" var="goalLevel"
                                itemLabel="#{goalLevel.name}" itemValue="#{goalLevel}" />
                            <p:ajax event="change" listener="#{goalForm.onGoalLevelChange}" update="@form" />
                        </p:selectOneMenu>
                    </div>
                </div>

                <div class="ui-col-12 ui-md-6">
                    <h5>Evaluation Weight (%)</h5>
                    <div class="ui-inputgroup">
                        <p:inputNumber value="#{goalForm.model.goalEvaluationWeight}" minValue="0" maxValue="100"
                            decimalPlaces="2" placeholder="e.g., 40.0"
                            styleClass="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" />
                    </div>
                </div>

                <!-- Parent Goal Selection (for child goals) -->
                <div class="ui-col-12"
                    rendered="#{goalForm.availableParentGoals != null and not empty goalForm.availableParentGoals}">
                    <h5>Parent Goal</h5>
                    <div class="ui-inputgroup">
                        <p:selectOneMenu value="#{goalForm.model.parentGoal}" converter="goalConverter"
                            styleClass="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full">
                            <f:selectItem itemLabel="Select Parent Goal" itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItems value="#{goalForm.availableParentGoals}" var="parent"
                                itemLabel="#{parent.goalTitle}" itemValue="#{parent}" />
                        </p:selectOneMenu>
                    </div>
                </div>

                <!-- Department Selection (Conditional) -->
                <div class="ui-col-12" rendered="#{goalForm.showDepartmentSelection}">
                    <h5>Department(s)</h5>
                    <div class="ui-inputgroup">
                        <p:selectManyMenu value="#{goalForm.selectedDepartments}" converter="departmentConverter"
                            filter="true" filterMatchMode="contains" showCheckbox="true" scrollHeight="200"
                            required="#{goalForm.showDepartmentSelection}"
                            styleClass="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full">
                            <f:selectItems value="#{goalForm.allDepartments}" var="d" itemLabel="#{d.name}"
                                itemValue="#{d}" />
                        </p:selectManyMenu>
                    </div>
                    <small style="color: #6c757d;">Select one or more departments that this goal applies to.</small>
                </div>

                <!-- Description -->
                <div class="ui-col-12">
                    <h5>Description</h5>
                    <div class="ui-inputgroup">
                        <p:inputTextarea value="#{goalForm.model.description}" rows="4"
                            placeholder="Provide a detailed explanation of the goal, including success criteria and key milestones"
                            styleClass="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" />
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="field col-12 p-d-flex p-jc-end p-mt-4">
                    <p:commandButton value="Cancel" action="#{goalForm.hide}"
                        styleClass="ui-button-outlined ui-button-danger p-mr-2" process="@this" immediate="true" />
                    <p:commandButton value="#{goalForm.isEditMode() ? 'Update Goal' : 'Save Goal'}"
                        actionListener="#{goalForm.save}" update="@form" process="@form" validateClient="true"
                        styleClass="ui-button-success" />
                </div>
            </div>
        </h:form>
    </ui:define>
</ui:composition>