<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/pages/californiatemplate/template.xhtml">

    <ui:define name="content">
        <h:form id="rolesPermissionsForm" enctype="multipart/form-data">
            <p:growl id="messages" showDetail="true" />

            <div class="p-grid">
                <!-- Left Panel: Roles List -->
                <div class="p-col-12 p-md-4">
                    <div class="card">
                        <div class="p-d-flex p-jc-between p-ai-center" style="margin-bottom: 10px;">
                            <h3 style="font-weight: bold;">Roles (#{rolesView.totalRecords})</h3>
                            <p:commandButton value="Create New Role" icon="fa fa-plus"
                                             styleClass="ui-button-success" process="@this"
                                             actionListener="#{roleFormDialog.show}">
                                <f:setPropertyActionListener value="#{null}" target="#{roleFormDialog.model}" />
                                <p:ajax event="dialogReturn" listener="#{rolesView.reloadFilterReset}" update=":rolesPermissionsForm:rolesListPanel" />
                            </p:commandButton>
                        </div>
                        <p:inputText id="searchRoleTerm" required="false"
                                     placeholder="Search for roles..."
                                     value="#{rolesView.searchTerm}" style="width: 100%; margin-bottom: 10px;">
                            <p:ajax event="keyup" listener="#{rolesView.reloadFilterReset}" update=":rolesPermissionsForm:rolesListPanel" />
                        </p:inputText>

                        <p:dataList id="rolesListPanel" value="#{rolesView.dataModels}" var="role" type="definition">
                            <f:facet name="header">
                                <h:outputText value="Roles" />
                            </f:facet>
                            <p:commandLink update=":rolesPermissionsForm:permissionPanel"
                                           actionListener="#{rolesView.loadSelectedRole(role)}"
                                           styleClass="p-d-flex p-jc-between p-ai-center p-py-2 p-px-3"
                                           style="border-bottom: 1px solid var(--surface-d); text-decoration: none; color: inherit;">
                                <div class="p-d-flex p-flex-column">
                                    <h:outputText value="#{role.name}" style="font-weight: bold;"/>
                                    <small class="p-text-muted">#{role.description}</small>
                                </div>
                                <i class="fa fa-lock"/>
                                <p:ajax update=":rolesPermissionsForm:permissionPanel" listener="#{rolesView.loadSelectedRole(role)}"/>
                            </p:commandLink>
                        </p:dataList>

                        <div class="p-mt-3">
                            <p:commandButton value="Save Changes" icon="fa fa-save"
                                             actionListener="#{rolesView.saveSelectedRolePermissions}"
                                             update=":rolesPermissionsForm:messages"
                                             styleClass="ui-button-primary"
                                             rendered="#{rolesView.selectedRole != null}" />
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Permissions Display and Management -->
                <div class="p-col-12 p-md-8">
                    <div class="card">
                        <p:panel id="permissionPanel" style="min-height: 500px;">
                            <f:facet name="header">
                                <h:outputText value="Permissions for: " rendered="#{rolesView.selectedRole != null}"/>
                                <h:outputText value="#{rolesView.selectedRole.name}" style="font-weight: bold;" rendered="#{rolesView.selectedRole != null}"/>
                                <h:outputText value="Select a role to view/manage permissions" rendered="#{rolesView.selectedRole == null}"/>
                            </f:facet>

                            <p:outputPanel rendered="#{rolesView.selectedRole != null}">
                                <div class="p-text-center p-mb-3">
                                    <h:outputText value="Full system access. Cannot be modified." style="color: red; font-style: italic;"/>
                                </div>
                                <p:selectManyCheckbox id="permissions-checkbox" value="#{rolesView.selectedPermissions}"
                                                      converter="permissionConverter" layout="responsive" columns="2" styleClass="ui-fluid"
                                                      disabled="#{rolesView.selectedRole.name == 'CEO'}">
                                    <f:selectItems value="#{rolesView.groupedPermissions}" />
                                    <p:ajax listener="#{rolesView.displaySelectedPermissions}" event="change" />
                                </p:selectManyCheckbox>
                            </p:outputPanel>
                        </p:panel>
                    </div>
                </div>
            </div>

            <p:blockUI block="rolesPermissionsForm">
                <p:graphicImage value="/resources/images/workingicon.png" />
            </p:blockUI>
            <p:confirmDialog global="true">
                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="fa fa-thumbs-up" />
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="fa fa-thumbs-down" />
            </p:confirmDialog>
        </h:form>
    </ui:define>
</ui:composition>